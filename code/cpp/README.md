## C++ Version

### Dependencies

```
sudo apt install libboost-all-dev libyaml-cpp-dev
```

This relies on pybind11, which is a submodule, so don't forget to

```
git submodule init 
git submodule update
```

### Build

```
mkdir buildRelease
cd buildRelease
cmake -DCMAKE_BUILD_TYPE=Release ..
make
```

* Use `buildDebug`, `CMAKE_BUILD_TYPE=Debug`, and QtCreator or Clion to debug

* if you use anaconda, you must link the python version to cmake:
```
cmake -DPYTHON_EXECUTABLE=path/to/python -DCMAKE_BUILD_TYPE=Release ..
```

### Run

#### Random Rollouts

```
./swarmgame -i ../config.yaml -o output.csv && python3 ../plot.py
```
A 'pdf animation' can be generated by running the plot function
```
python3 ../plot_pdf.py
```
instead of plot.py

#### GLAS Rollouts

```
cpp$ python3 convertNN.py ../../../models/il_current_a.pt ../../../models/il_current_b.pt nn.yaml
buildRelease$ ./swarmgame -i ../config.yaml -n ../nn.yaml -o output.csv && python3 ../plot.py
```

#### Testing GLAS

First extract the weights and store them in `nn.yaml`, then play a game using GLAS
```
cpp$ python3 convertNN.py ../../../models/il_current_a.pt ../../../models/il_current_b.pt nn.yaml
build$ ./test_glas -i ../config.yaml -n ../nn.yaml -o output.csv && python3 ../plot.py
```

#### Testing Python Bindings

This uses the bindings in `buildRelease` and has some examples on how to use the bindings.

```
python3 regression_test.py
```

### Notes

* MCTS is generic in the style of libMultiRobotPlanning, with templated State, Action, and GameLogic
* By default, ties are not broken randomly, as in the Python version
* The GameState is templated no longer templated by #Attackers/#Defenders to allow Python bindings. The performance loss is minimal, since the runtime is dominated by rollouts, not by copy operations.

### Todo

* Profile and perf improvements
  * Splitting the gamestate in A/B could avoid some copy operations
  * If we have an upper bound on the branching, we can use static allocation for children pointers and actions

### Profiling

```
mkdir buildProfile
cd buildProfile
cmake -DCMAKE_BUILD_TYPE=RelWithDebInfo ..
make
perf record --call-graph dwarf ./swarmgame -i ../config.yaml -o output.csv
~/sw/hotspot-v1.2.0-x86_64.AppImage perf.data
```

Where hotspot is from https://www.kdab.com/hotspot-gui-linux-perf-profiler/

## CLANG

```
CC=clang CXX=clang++ cmake
```